!function(e){e.fn.multiselectable=function(t){function s(s){var l,i=e(this),a=i.parent(),n=i.index(),d=a.find(".multiselectable-previous"),c=(d=d.length?d:e(a.find("."+t.selectedClass)[0]).addClass("multiselectable-previous")).index();((s.ctrlKey||s.metaKey)&&(i.hasClass(t.selectedClass)?(i.removeClass(t.selectedClass).removeClass("multiselectable-previous"),i.not(".child").length&&i.nextUntil(":not(.child)").removeClass(t.selectedClass)):(a.find(".multiselectable-previous").removeClass("multiselectable-previous"),i.addClass(t.selectedClass).addClass("multiselectable-previous"),i.not(".child").length&&i.nextUntil(":not(.child)").addClass(t.selectedClass))),s.shiftKey)?(a.find(".multiselectable-shift").removeClass(t.selectedClass).removeClass("multiselectable-shift"),c<n?l=i.prevUntil(".multiselectable-previous").add(d).add(i):c>n&&(l=i.nextUntil(".multiselectable-previous").add(d).add(i)),l.addClass(t.selectedClass).addClass("multiselectable-shift")):a.find(".multiselectable-shift").removeClass("multiselectable-shift");s.ctrlKey||s.metaKey||s.shiftKey||(a.find(".multiselectable-previous").removeClass("multiselectable-previous"),i.hasClass(t.selectedClass)||(a.find("."+t.selectedClass).removeClass(t.selectedClass),i.addClass(t.selectedClass).addClass("multiselectable-previous"),i.not(".child").length&&i.nextUntil(":not(.child)").addClass(t.selectedClass))),t.mousedown(s,i)}function l(s){if(!e(this).is(".ui-draggable-dragging")){var l=e(this),i=l.parent();s.ctrlKey||s.metaKey||s.shiftKey||(i.find(".multiselectable-previous").removeClass("multiselectable-previous"),i.find("."+t.selectedClass).removeClass(t.selectedClass),l.addClass(t.selectedClass).addClass("multiselectable-previous"),l.not(".child").length&&l.nextUntil(":not(.child)").addClass(t.selectedClass)),t.click(s,l)}}return t||(t={}),t=e.extend({},e.fn.multiselectable.defaults,t),this.each(function(){var i=e(this);i.data("multiselectable")||i.data("multiselectable",!0).delegate(t.items,"mousedown",s).delegate(t.items,"click",l).disableSelection()})},e.fn.multiselectable.defaults={click:function(e,t){},mousedown:function(e,t){},selectedClass:"selected",items:"li"},e.fn.multisortable=function(t){t||(t={});var s=e.extend({},e.fn.multisortable.defaults,t);function l(t,l){if(l.find("."+s.selectedClass).length>0){var i=t.data("i"),a=l.find("."+s.selectedClass).filter(function(){return e(this).data("i")<i}).css({position:"",width:"",left:"",top:"",zIndex:""});t.before(a);var n=l.find("."+s.selectedClass).filter(function(){return e(this).data("i")>i}).css({position:"",width:"",left:"",top:"",zIndex:""});t.after(n),setTimeout(function(){n.add(a).addClass(s.selectedClass)},0)}}return this.each(function(){var i=e(this);i.multiselectable({selectedClass:s.selectedClass,click:s.click,items:s.items,mousedown:s.mousedown}),t.cancel=s.items+":not(."+s.selectedClass+")",t.placeholder=s.placeholder,t.start=function(t,l){if(l.item.hasClass(s.selectedClass)){var i=l.item.parent();i.find("."+s.selectedClass).each(function(t){e(this).data("i",t)});var a=i.find("."+s.selectedClass).length*l.item.outerHeight();l.placeholder.height(a)}s.start(t,l)},t.stop=function(e,t){l(t.item,t.item.parent()),s.stop(e,t)},t.sort=function(t,l){var i=l.item.parent(),a=l.item.data("i"),n=parseInt(l.item.css("top").replace("px","")),d=parseInt(l.item.css("left").replace("px",""));e.fn.reverse=Array.prototype._reverse||Array.prototype.reverse;var c=0;e("."+s.selectedClass,i).filter(function(){return e(this).data("i")<a}).reverse().each(function(){c+=e(this).outerHeight(),e(this).css({left:d,top:n-c,position:"absolute",zIndex:1e3,width:l.item.width()})}),c=l.item.outerHeight(),e("."+s.selectedClass,i).filter(function(){return e(this).data("i")>a}).each(function(){var t=e(this);t.css({left:d,top:n+c,position:"absolute",zIndex:1e3,width:l.item.width()}),c+=t.outerHeight()}),s.sort(t,l)},t.receive=function(e,t){l(t.item,t.sender),s.receive(e,t)},i.sortable(t).disableSelection()})},e.fn.multisortable.defaults={start:function(e,t){},stop:function(e,t){},sort:function(e,t){},receive:function(e,t){},click:function(e,t){},mousedown:function(e,t){},selectedClass:"selected",placeholder:"placeholder",items:"li"}}(jQuery);